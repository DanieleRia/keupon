<style type="text/css">
    .subscription_text {
        font-family: Arial, Helvetica, sans-serif;
        font-size: 13px;
        color: #ffffff;
        text-decoration: none;
    }
    }
</style>
<script Language="JavaScript">
    <!--
    function sform_validator(){
        var theForm = document.forms['new_keupon_subscribers'];
        
        return emailCheck(theForm.keupon_subscribers_email.value);
    }
    
    function emailCheck(emailStr){
    
        /* The following variable tells the rest of the function whether or not
         to verify that the address ends in a two-letter country or well-known
         TLD.  1 means check it, 0 means don't. */
        var checkTLD = 1;
        
        /* The following is the list of known TLDs that an e-mail address must end with. */
        
        var knownDomsPat = /^(com|net|org|edu|int|mil|gov|arpa|biz|aero|name|coop|info|pro|museum)$/;
        
        /* The following pattern is used to check if the entered e-mail address
         fits the user@domain format.  It also is used to separate the username
         from the domain. */
        var emailPat = /^(.+)@(.+)$/;
        
        /* The following string represents the pattern for matching all special
         characters.  We don't want to allow special characters in the address.
         These characters include ( ) < > @ , ; : \ " . [ ] */
        var specialChars = "\\(\\)><@,;:\\\\\\\"\\.\\[\\]";
        
        /* The following string represents the range of characters allowed in a
         username or domainname.  It really states which chars aren't allowed.*/
        var validChars = "\[^\\s" + specialChars + "\]";
        
        /* The following pattern applies if the "user" is a quoted string (in
         which case, there are no rules about which characters are allowed
         and which aren't; anything goes).  E.g. "jiminy cricket"@disney.com
         is a legal e-mail address. */
        var quotedUser = "(\"[^\"]*\")";
        
        /* The following pattern applies for domains that are IP addresses,
         rather than symbolic names.  E.g. joe@[123.124.233.4] is a legal
         e-mail address. NOTE: The square brackets are required. */
        var ipDomainPat = /^\[(\d{1,3})\.(\d{1,3})\.(\d{1,3})\.(\d{1,3})\]$/;
        
        /* The following string represents an atom (basically a series of non-special characters.) */
        
        var atom = validChars + '+';
        
        /* The following string represents one word in the typical username.
         For example, in john.doe@somewhere.com, john and doe are words.
         Basically, a word is either an atom or quoted string. */
        var word = "(" + atom + "|" + quotedUser + ")";
        
        // The following pattern describes the structure of the user
        
        var userPat = new RegExp("^" + word + "(\\." + word + ")*$");
        
        /* The following pattern describes the structure of a normal symbolic
         domain, as opposed to ipDomainPat, shown above. */
        var domainPat = new RegExp("^" + atom + "(\\." + atom + ")*$");
        
        /* Finally, let's start trying to figure out if the supplied address is valid. */
        
        /* Begin with the coarse pattern to simply break up user@domain into
         different pieces that are easy to analyze. */
        var matchArray = emailStr.match(emailPat);
        
        if (matchArray == null) {
        
            /* Too many/few @'s or something; basically, this address doesn't
             even fit the general mould of a valid e-mail address. */
            alert("Email address seems incorrect (check @ and .'s)");
            return false;
        }
        var user = matchArray[1];
        var domain = matchArray[2];
        
        // Start by checking that only basic ASCII characters are in the strings (0-127).
        
        for (i = 0; i < user.length; i++) {
            if (user.charCodeAt(i) > 127) {
                alert("Ths username contains invalid characters.");
                return false;
            }
        }
        for (i = 0; i < domain.length; i++) {
            if (domain.charCodeAt(i) > 127) {
                alert("Ths domain name contains invalid characters.");
                return false;
            }
        }
        
        // See if "user" is valid
        
        if (user.match(userPat) == null) {
        
            // user is not valid
            
            alert("The username doesn't seem to be valid.");
            return false;
        }
        
        /* if the e-mail address is at an IP address (as opposed to a symbolic
         host name) make sure the IP address is valid. */
        var IPArray = domain.match(ipDomainPat);
        if (IPArray != null) {
        
            // this is an IP address
            
            for (var i = 1; i <= 4; i++) {
                if (IPArray[i] > 255) {
                    alert("Destination IP address is invalid!");
                    return false;
                }
            }
            return true;
        }
        
        // Domain is symbolic name.  Check if it's valid.
        
        var atomPat = new RegExp("^" + atom + "$");
        var domArr = domain.split(".");
        var len = domArr.length;
        for (i = 0; i < len; i++) {
            if (domArr[i].search(atomPat) == -1) {
                alert("The domain name does not seem to be valid.");
                return false;
            }
        }
        
        /* domain name seems valid, but now make sure that it ends in a
         known top-level domain (like com, edu, gov) or a two-letter word,
         representing country (uk, nl), and that there's a hostname preceding
         the domain or country. */
        if (checkTLD && domArr[domArr.length - 1].length != 2 &&
        domArr[domArr.length - 1].search(knownDomsPat) == -1) {
            alert("The address must end in a well-known domain or two letter " + "country.");
            return false;
        }
        
        // Make sure there's a host name preceding the domain.
        
        if (len < 2) {
            alert("This address is missing a hostname!");
            return false;
        }
        
        // If we've gotten this far, everything's valid!
        return true;
    }
    
    //-->
</script>
<br/>
<%@deal=KeuponSubscribers.new() %>
<div id='popup_center' style=" width: 604px; padding-left: 210px; display: block;margin-top: -150px;">
    <a href="#" onclick="hideElt('popup_create_deal');"><img src="/images/close_btn.png" border="0" style="float:right;position: absolute;margin-left: 530px;margin-top: -10px;"/></a>
    <table class="popup" align="center" width="100%" cellspacing="1px">
        <tr>
            <td class="popup">
                <table width="570px" border="0" cellspacing="0" cellpadding="0" style="border:3px solid red;">
                    <tr>
                        <td background="/images/subscribe_lady_img.jpg" bgcolor="#000000" style="background-repeat:no-repeat;">
                            <table width="100%" border="0" cellspacing="0" cellpadding="0">
                            <tr>
                                <td width="4%">
                                    &nbsp;
                                </td>
                                <td width="72%">
                                    &nbsp;
                                </td>
                                <td colspan="2">
                                    &nbsp;
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    &nbsp;
                                </td>
                                <td class="subscription_text">
                                    The shopping addicts team at Keupons.com promises you a steady stream of Super Bargain Deals!
                                    <br/>
                                    Join the mailing list and be the first to know what deals we have for you. 
                                    <br/>
                                    <br/>
                                    Keupons.com the ONLY site where the price gets lower and lower as more people buy!
                                    <br/>
                                    <br/>
                                </td>
                                <td colspan="2">
                                    &nbsp;
                                </td>
                            </tr>
                            <% form_for @deal, :url => { :controller=>'deals',:action => "get_deals_by_email" } , :html => { :multipart => true }  do |f| %>
                            <tr>
                                <td height="148">
                                    &nbsp;
                                </td>
                                <td colspan="2" valign="top">
                                    <table width="100%" border="0" cellspacing="0" cellpadding="0">
                                        <tr>
                                            <td>
                                                <table width="100%" border="0" cellspacing="0" cellpadding="0">
                                                    <tr>
                                                        <td width="5%" height="25">
                                                            <!--<input type="checkbox" name="checkbox" id="checkbox" />-->
                                                        </td>
                                                        <td width="15%" class="subscription_text">
                                                            Your Email:
                                                        </td>
                                                        <td width="80%">
                                                            <%= f.text_field :email, :size=>"20%",:onBlur=>"validate_email();" %>
                                                        </td>
                                                    </tr>
                                                    <!--<tr>
                                                    <td><input type="checkbox" name="checkbox2" id="checkbox2" /></td>
                                                    <td width="15%" class="subscription_text">SMS</td>
                                                    <td><input type="text" name="textfield2" id="textfield2" /></td>
                                                    </tr> -->
                                                </table>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>
                                                &nbsp;
                                            </td>
                                        </tr>
                                        <tr>
                                            <td height="40" class="subscription_text">
                                                <strong>Choose the categories of Super Bargain Deals that you're interested in. </strong>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>
                                                <table width="100%" border="0" cellspacing="0" cellpadding="0">
                                                    <tr>
                                                        <%DealCategory.all.each_with_index do |cat,i| %>
                                                        <%if i%3!=0 %>
                                                        <td width="4%" height="25">
                                                            <input checked type="checkbox" name="category[]" id="checkbox3" value='<%=cat.id%>'/>
                                                        </td>
                                                        <td width="23%" class="subscription_text">
                                                            <%=cat.name %>
                                                        </td>
                                                        <%else %>
                                                    </tr>
                                                    <tr>
                                                        <td width="4%" height="25">
                                                            <input checked type="checkbox" name="category[]" id="checkbox3" value='<%=cat.id%>'/>
                                                        </td>
                                                        <td width="23%" class="subscription_text">
                                                            <%=cat.name %>
                                                        </td>
                                                        <%end %>
                                                        <%end %>
                                                    </tr>
                                                </table>
                                            </td>
                                        </tr>
                                    </table>
                                </td>
                                <td width="4%">
                                    &nbsp;
                                </td>
                            </tr>
                            <tr>
                                <td height="63">
                                    &nbsp;
                                </td>
                                <td align="left">
                                    <%=image_submit_tag ("subscribe_btn.jpg"), :onclick => "return sform_validator();" %>
                                </td>
                                <td colspan="2">
                                    &nbsp;
                                </td>
                            </tr>
                            <% end %>
                            </form>
                            <tr>
                                <td>
                                    &nbsp;
                                </td>
                                <td>
                                    &nbsp;
                                </td>
                                <td colspan="2">
                                    &nbsp;
                                </td>
                            </tr>
                        </table>
                        </td>
                    </tr>
                </table>
            </td>
        </tr>
    </table>
</div>
